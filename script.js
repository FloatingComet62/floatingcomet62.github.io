const neofetchLogo = [
"                                       %%%##%#                                           ",
"                                    %%%%%%##%#%%%%                                       ",
"                                  %%#**+++*##@@@#@@@%%#%@%%##                            ",
"                               *#@%*#*+++++++#@@%@@@###**#%#@%                           ",
"                     **%%**+=-+==-++++==*+++*%#*%#*++-+=-==+**+*%@@                      ",
"                   =%@@@@@@#*+==-==-=+=#*+##********=+=++=++=++++*@@@%   %               ",
"                 #++=+++=#=--------=#%#*#%####++====--=--=-=====++*#%###*#               ",
"                  +-======---------=@%*=====++==-----------==+-==+++#**+@#               ",
"               #+===#%#+==-----::------==*=--------------:--------==+*#*+                ",
"             ====**=======---::::---:--------------------::--------=-+=++**              ",
"            #==+***====------::::::::::----------------:---:-:--:--=-=+++*++*            ",
"          ##*++=+==----------:::::::::-----------------::=--------======+++++*           ",
"        #**+=+==+=--------:----::---------------------------------:---=+*+##++#          ",
"       #*+==++====--:::::-::::::---:----------------------::--:::-----=-=+= #+ *         ",
"        ===+=+====------:::-::--::::--::----:--::---:-:---::::-::-------===++ *+         ",
"     #*=-=-----=+=----:::---:--::------------:-::::::::-::::::------------==++==*        ",
"      #--==------::::----------:-----------------:-:::---::::---------------==+=*        ",
"      =-==-=-----::---------------------=-----------::-----:::-:---:----------===        ",
"       ==-----:::-:::-----------------------:-::---::::-:---:-:::--:-----------===       ",
"      +--:--::----------------------====-----::-:::-:::-:-----:--:---:-::-------=--#     ",
"      =---:::----:----------------======-----:::::--:---::-::---:::-::-::----------      ",
"       =------:::::---:----------====++===----::::--:::::-:::::-::-----:----:::---*      ",
"       #=-----::-----==--=-=---=====+++++===--:-:::::::--::::::--::::------:::::--       ",
"       +=---::::----====-==--====+++++++++++==---::::::::::::::--:::::----::::::-=       ",
"      #=-------=---------------==++++++++++++++==-:::::::::::::-:-:::::-:::::::--=       ",
"        # =--==+++===---::::---=====+++++++++++++++=--::::-::::::::-:::--::::::::=       ",
"        ++ +====++===-:---===+=--=-= ==================-:::::::::::--==:--:::-:::-       ",
"         #++=--:-+=:-============--===++++++++++++++==--:::::::::------=*::::-:::#       ",
"       *#+  +++=::--=====-----===----==+++++++++++++==--:::::::-----=====+-::-:--        ",
"     =-==-   #+=::=---====----=*++=--===++++++****++==-----=-------=++====+:--::-        ",
"      -=##    =-- +-=--------=========++++++******+++=--:---==+==-=++++===+::-::-        ",
"      +=##*      --+-------=====-===+++++++*******++=-------++++=---=++==+-::-::*        ",
"       = --     --++=--:======++-++++++++++********+=-==--===+*======+*=++::::-:+*       ",
"       *++-   ---++===:-==++++:=+++++++++++******+*++==---+=++*======++++:-----          ",
"        =#+  ---+++====--==+++++++++++++++++++++++++==+===+*++===+=+++++::-::--          ",
"          *----++++++======+++++++++++++++++++++++++====++**+++=+**+=++.:--::-+          ",
"            ++++==++++++=-==++++++++++++++++++++++====+==++*++++++++*+:::-:::-           ",
"             +==-:::::==--===++++++++++++++++++++====+=++++*=++++++*+---:::::-           ",
"               +===========+==+++++++++++++++=+++=========++-++++++++=:::::-===-:        ",
"               #*+=------======+++++++++++=======+===+=======+++++++++-:.:------==:      ",
"                =---:::----=====++++++=================+=====++++++++++-:-----::--++     ",
"                +==+==-=-------==+++++==================+====+++++++++-:--:---:::---=*   ",
"                **+=-==++--==---==+++=================+=======++++++=-:--:---::::::--==##",
"                  =-+%+**++-::---=+++=================-==--=-==++++=----:----:::::::----=",
"                  %=-:..:-==-================-=-=----------=-==++==-:::::----:::::::-:-:-",
"                   %#+*===-================-=---==--------:---====-::::::::--::::::::-:--",
"                   *====--===============-------------------------:::::::::::::::::-::--:",
"                    %=-----=============--------------:---:-------::::::::::-::::::::----",
"                    :%+=--=============-----------:-----:--------:::::::::::::::::::::--=",
"                   %:=#*+============----:--:---:::::-:---------::::::::::::::::::::::---",
"                   .::%*+===========--::-:-::-::::::-----------::::::::::::::::::::::----",
"                  %:::+*+======-----:::::::::::::::::---------::.::::::::::::::::::------",
"                  **+-.-=--------:::::::::::::::::---------==::.::::::::::::::::::-----+=",
"              -...:::::...:::::::::::....:::::::----------=-:::::::::::::::::::::-----=-=",
"             %..::............ ..  ......:-:::-------------:::::::::::::::::::::--::=----",
"              ..................  ........:----------=--=-:::::::::::::::::::::-:::=--=::",
"              ................    .........----------=---::..::::::::::::.::::-::-----:::",
]

function getAge(birthDateStr) {
  const today = new Date();
  const birth = new Date(birthDateStr);

  let years = today.getFullYear() - birth.getFullYear();
  let months = today.getMonth() - birth.getMonth();
  let days = today.getDate() - birth.getDate();

  if (days < 0) {
    months--;
    days += new Date(today.getFullYear(), today.getMonth(), 0).getDate();
  }

  if (months < 0) {
    years--;
    months += 12;
  }

  return { years, months, days };
}

function formatAge({ years, months, days }) {
  let output = `${years} years`;
  if (months == 0) {
  } else if (months == 1) {
    output += `, 1 month`
  } else {
    output += `, ${months} months`;
  }

  if (days == 0) {
  } else if (days == 1) {
    output += `, 1 day`
  } else {
    output += `, ${days} days`;
  }

  return output;
}

function loadNeoFetchLogo(fontSize) {
  const textRoot = document.getElementById("logo");
  textRoot.setAttribute("font-size", fontSize);
  for (let i = 0; i < neofetchLogo.length; i++) {
    const node = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
    node.setAttribute("x", "0");
    node.setAttribute("y", (fontSize * i).toString());
    node.textContent = neofetchLogo[i];
    textRoot.appendChild(node);
  }
}

function clearNeofetchLogo() {
  const textRoot = document.getElementById("logo");
  while (textRoot.firstChild) {
    textRoot.removeChild(textRoot.firstChild);
  }
}

function loadAge() {
  const uptime = document.getElementById("uptime");
  uptime.innerText = formatAge(getAge("2007-02-19"));

  const keys = document.getElementsByClassName("key");
  for (const key of keys) {
    const colon = document.createElement("span")
    colon.classList.add("colon");
    colon.innerText = ":";
    key.appendChild(colon);
  }
}

function formatNeofetchInfo() {
  const width = 60;
  const bars = document.getElementsByClassName("bar");
  for (const bar of bars) {
    const lengthToAdd = width - bar.innerText.length - 1;
    let barStr = "";
    for (let i = 0; i < lengthToAdd; i++)
      barStr += "â€”";
    bar.innerText += " " + barStr;
  }
}

function setCanvasSize(dim) {
  const d = `${dim}px`;
  const svg = document.getElementById("svg");
  const rect = document.getElementById("rect");
  svg.setAttribute("width", d);
  svg.setAttribute("height", d);
  rect.setAttribute("width", d);
  rect.setAttribute("height", d);
}

function main() {
  if (window.innerWidth > 1000) {
    clearNeofetchLogo();
    loadNeoFetchLogo(window.innerWidth / 200);
    formatNeofetchInfo();
    setCanvasSize(window.innerWidth/3);
  } else {
    clearNeofetchLogo();
    loadNeoFetchLogo(window.innerWidth / 60);
    formatNeofetchInfo();
    setCanvasSize(window.innerWidth);
  }
}

window.onload = () => {
  loadAge();
  main();
}
window.onresize = () => main();
